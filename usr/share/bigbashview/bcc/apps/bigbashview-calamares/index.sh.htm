#!/bin/bash
##################################
#  Author1: Bruno Goncalves (www.biglinux.com.br) 
#  Author2: Rafael Ruscher (rruscher@gmail.com)  
#  Date:    2022/02/28 
#  Modified:2022/08/05 
#  
#  Description: Calamares modified usage of BigLinux 
#  
# Licensed by GPL V2 or greater
##################################

export LANGUAGE=$(cat /tmp/big_language)
export LANG=$(cat /tmp/big_language)

#Translation
LANGUAGE=$LANG:en
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=calamares-biglinux

DEFAULT=$"PADRÃO"
PERFORMANCE=$"DESEMPENHO"
COMPATIBILITY=$"COMPATIBILIDADE"
COMPRESS=$"Compacta os dados"
SNAPSHOT=$"Pontos de restauração"
FSYNC=$"Adia a gravação dos dados"
OLD_PARTITION_TABLE=$"Funciona com tabelas de particionamento antigas"
BTRFS_WITH_FSYNC=$"BTRFS com fsync"
BTRFS_WITHOUT_FSYNC=$"BTRFS sem fsync"
SELECT=$"SELECIONAR"
TITLE=$"Instalar no HD"
INFOBOOT=$"* Não utilize /boot separado"

cat << EOF
<head>
  <meta charset="UTF-8">
  <title>$TITLE</title>
  <script src="/usr/share/bigbashview/bcc/materialize/js/jquery.js"></script>
  <link rel="stylesheet" href="./style.css">
</head>
EOF

# Get body tag with color light or not
/usr/share/bigbashview/bcc/shell/getbgcolor.sh

cat <<EOF
<div class="dark-light">
    <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
    </svg>
</div>

<!-- <div class="Message" id="js-timer">
  <div class="Message-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 30px;"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>
  </div>
  <div class="Message-body">
    <p>Utilizar a <pre>/boot</pre> </p>
    <p class="u-italic">em partição separada trás problemas ao sistema de snapshots</p>
  </div>
  <button class="Message-close js-messageClose"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" style="width: 10px;"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></button>
</div> -->


<!-- partial:index.partial.html -->
EOF

echo '<div class=info>'
echo $"O sistema está em modo"
echo '<strong>'
[ -d /sys/firmware/efi ] && echo ' UEFI' || echo ' BIOS (Legacy)'
echo '</strong>'
echo $"e com o kernel" 
echo '<strong>'
echo "$(uname -r | cut -f1 -d-)" 
echo '</strong>'
echo '</div>'

cat << EOF
<!-- <div class="background"> -->

  <div class="container"> 

    <div class="panel calamares-big-table"> 
      <div class="calamares-big-plan">
        <img src="icon-big-plain.png" alt="Boeing 747" class="calamares-big-img" style="width: 100px;">
        <h3 class="calamares-big-header">$DEFAULT</h3>
        
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#459551" stroke="#459551" stroke-width="30" stroke-linecap="round" d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"/></svg></div>
        <nobr>$COMPRESS</nobr>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#459551" stroke="#459551" stroke-width="30" stroke-linecap="round" d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"/></svg></div>
        <nobr>$SNAPSHOT</nobr>
        <span class="calamares-big-minileg">$INFOBOOT</span>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#ff593f" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></div>
        <nobr>$FSYNC</nobr>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#ff593f" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></div>
        $OLD_PARTITION_TABLE
        </div>
        <div class="p"> </div>        
        
        <span class="calamares-big-leg">$BTRFS_WITH_FSYNC</span>
        <a href="wait.sh.htm?option=btrfs_sync" class="calamares-big-button">$SELECT</a>
      </div>

      <div class="calamares-big-plan">
        <img src="icon-big-enterprise-plain.png" alt="Enterprise" class="calamares-big-img" style="width: 100px;">
        <h3 class="calamares-big-header">$PERFORMANCE</h3>
        
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#459551" stroke="#459551" stroke-width="30" stroke-linecap="round" d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"/></svg></div>
        <nobr>$COMPRESS</nobr>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#459551" stroke="#459551" stroke-width="30" stroke-linecap="round" d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"/></svg></div>
        <nobr>$SNAPSHOT</nobr>
        <span class="calamares-big-minileg">$INFOBOOT</span>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#459551" stroke="#459551" stroke-width="30" stroke-linecap="round" d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"/></svg></div>
        <nobr>$FSYNC</nobr>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#ff593f" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></div>
        $OLD_PARTITION_TABLE
        </div>
        <div class="p"> </div>                
        
        <span class="calamares-big-leg">$BTRFS_WITHOUT_FSYNC</span>
        <a href="wait.sh.htm?option=btrfs_disable_sync" class="calamares-big-button is-featured">$SELECT</a>
      </div>
      
      <div class="calamares-big-plan">
        <img src="icon-big-antonov-plain.png" alt="Antonov-225 Mriya" class="calamares-big-img" style="width: 100px;">
        <h3 class="calamares-big-header">$COMPATIBILITY</h3>
        
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#ff593f" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></div>
        <nobr>$COMPRESS</nobr>
        </div>
        <div class="p ajust">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#ff593f" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></div>
        <nobr>$SNAPSHOT</nobr>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#ff593f" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg></div>
        <nobr>$FSYNC</nobr>
        </div>
        <div class="p">
        <div class="text-bullet-centered"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#459551" stroke="#459551" stroke-width="30" stroke-linecap="round" d="M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"/></svg></div>
        $OLD_PARTITION_TABLE
        </div>
        <div class="p"> </div>
        
        <span class="calamares-big-leg">EXT4</span>
        <a href="wait.sh.htm?option=ext4" class="calamares-big-button">$SELECT</a>
      </div>
    </div>
  </div>
<!-- </div> -->
  <div class="logo">
      <img id="btn-big" src="logo.svg" class="logo-biglinux">
  </div>
<script  src="./script.js"></script>

</body>
</html>
EOF
